name: build-site
on:
  push:
    branches:
      - 'main'
      - 'develop'
      - 'preview/**'
jobs:
  build-site:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        persist-credentials: false
        fetch-depth: 0
    - name: Install deps
      run: sudo apt install pandoc
    - name: Render site
      run: exec ./build.sh
    - name: Setup git config
      run: |
        export email=$(git log -n 1 --pretty=format:%ae)
        export name=$(git log -n 1 --pretty=format:%an)
        rm -rf .git
        cd site && git init
        git remote add origin https://github.com/MariposaGentil/MariposaGentil.github.io
        git config --local user.email "$email"
        git config --local user.name "$name"
    - name: Push to Github pages
      run: |
        cd site/
        git add .
        git commit -a -m "${{ env.CI_COMMIT_MESSAGE }}  Automated commit generated from Gihub acions in cocoon repo"
        git push
    - name: Auxiliary functions
      run: |
        cd site/
        echo $(ls)
        echo $(git config user.name)
        echo $(git remote -v)
        echo $(git status)
        echo $(git log)



